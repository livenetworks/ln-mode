<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ln-external-links Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }

        h1 {
            color: #333;
            border-bottom: 3px solid #007bff;
            padding-bottom: 10px;
        }

        h2 {
            color: #555;
            margin-top: 30px;
        }

        .section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .links {
            margin: 15px 0;
        }

        .links a {
            display: inline-block;
            margin: 5px 10px 5px 0;
            padding: 8px 15px;
            background: #007bff;
            color: white;
            text-decoration: none;
            border-radius: 4px;
            transition: background 0.3s;
        }

        .links a:hover {
            background: #0056b3;
        }

        .internal-link {
            background: #28a745 !important;
        }

        .internal-link:hover {
            background: #1e7e34 !important;
        }

        button {
            background: #6c757d;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
        }

        button:hover {
            background: #5a6268;
        }

        #eventLog {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            max-height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }

        .log-entry {
            margin: 5px 0;
            padding: 5px;
            border-left: 3px solid #007bff;
            background: white;
        }

        .log-processed {
            border-left-color: #28a745;
        }

        .log-clicked {
            border-left-color: #ffc107;
        }

        #dynamicContainer {
            min-height: 50px;
            border: 2px dashed #dee2e6;
            padding: 15px;
            border-radius: 4px;
            background: #fff;
        }

        .info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            border-radius: 4px;
            padding: 12px;
            margin: 10px 0;
            color: #0c5460;
        }

        .legend {
            display: flex;
            gap: 20px;
            margin: 15px 0;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 3px;
        }

        .legend-external {
            background: #007bff;
        }

        .legend-internal {
            background: #28a745;
        }
    </style>
</head>
<body>
    <h1>üîó ln-external-links Component Test</h1>

    <div class="info">
        <strong>What to test:</strong>
        <ul>
            <li>External links should open in new tab with <code>target="_blank"</code> and <code>rel="noopener noreferrer"</code></li>
            <li>Internal links should remain unchanged</li>
            <li>Events should be logged below when links are processed or clicked</li>
            <li>Dynamically added links should be automatically processed</li>
        </ul>
    </div>

    <div class="legend">
        <div class="legend-item">
            <div class="legend-color legend-external"></div>
            <span>External Link (will open in new tab)</span>
        </div>
        <div class="legend-item">
            <div class="legend-color legend-internal"></div>
            <span>Internal Link (same tab)</span>
        </div>
    </div>

    <!-- Section 1: Static Links -->
    <div class="section">
        <h2>1. Static Links (Loaded with Page)</h2>
        <div class="links">
            <a href="/page1" class="internal-link">Internal Link 1</a>
            <a href="/about" class="internal-link">Internal Link 2</a>
            <a href="https://google.com">Google</a>
            <a href="https://github.com">GitHub</a>
            <a href="https://stackoverflow.com">Stack Overflow</a>
        </div>
        <p><small>Check the external links' attributes in DevTools - they should have <code>target="_blank"</code> and <code>rel="noopener noreferrer"</code></small></p>
    </div>

    <!-- Section 2: Dynamic Content -->
    <div class="section">
        <h2>2. Dynamic Content (Added via JavaScript)</h2>
        <div>
            <button id="addExternalLink">Add External Link</button>
            <button id="addInternalLink">Add Internal Link</button>
            <button id="addMultipleLinks">Add Multiple Links</button>
            <button id="clearDynamic">Clear</button>
        </div>
        <div id="dynamicContainer">
            <em>Dynamic links will appear here...</em>
        </div>
    </div>

    <!-- Section 3: Manual Processing -->
    <div class="section">
        <h2>3. Manual Processing API</h2>
        <p>Test manual processing using <code>window.lnExternalLinks.process()</code></p>
        <button id="testManualProcessing">Add Link and Process Manually</button>
        <div id="manualContainer" style="margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 4px;">
            <em>Manual processing test area...</em>
        </div>
    </div>

    <!-- Section 4: Area Elements -->
    <div class="section">
        <h2>4. Area Elements (Image Maps)</h2>
        <p>External links in image maps should also be processed:</p>
        <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='200'%3E%3Crect width='400' height='200' fill='%23e9ecef'/%3E%3Ctext x='50%25' y='50%25' text-anchor='middle' fill='%23495057' font-family='Arial' font-size='16'%3EImage Map Test%3C/text%3E%3C/svg%3E"
             usemap="#testmap" alt="Test Image Map" style="border: 1px solid #dee2e6; border-radius: 4px;">
        <map name="testmap">
            <area shape="rect" coords="0,0,200,100" href="https://google.com" alt="Google">
            <area shape="rect" coords="200,0,400,100" href="/internal" alt="Internal">
            <area shape="rect" coords="0,100,200,200" href="https://github.com" alt="GitHub">
            <area shape="rect" coords="200,100,400,200" href="/about" alt="About">
        </map>
        <p><small>Hover over the image - external areas (left side) should open in new tab</small></p>
    </div>

    <!-- Section 5: Event Log -->
    <div class="section">
        <h2>5. Event Log</h2>
        <p>Monitor component events:</p>
        <button id="clearLog">Clear Log</button>
        <div id="eventLog">
            <em>Events will be logged here...</em>
        </div>
    </div>

    <!-- Include the component -->
    <script src="ln-external-links.js"></script>

    <!-- Test script -->
    <script>
        // Event counter
        let eventCounter = 0;

        // Log helper
        function log(message, type = 'info') {
            const logDiv = document.getElementById('eventLog');
            const entry = document.createElement('div');
            entry.className = 'log-entry log-' + type;

            const timestamp = new Date().toLocaleTimeString();
            entry.innerHTML = `<strong>[${timestamp}]</strong> ${message}`;

            logDiv.appendChild(entry);
            logDiv.scrollTop = logDiv.scrollHeight;

            eventCounter++;
        }

        // Listen for processed events
        document.addEventListener('ln-external-links:processed', function(e) {
            log(`‚úÖ Link processed: <strong>${e.detail.href}</strong>`, 'processed');
        });

        // Listen for clicked events
        document.addEventListener('ln-external-links:clicked', function(e) {
            log(`üñ±Ô∏è External link clicked: <strong>${e.detail.href}</strong> (text: "${e.detail.text}")`, 'clicked');
        });

        // Dynamic link buttons
        document.getElementById('addExternalLink').addEventListener('click', function() {
            const container = document.getElementById('dynamicContainer');
            const link = document.createElement('a');
            link.href = 'https://example.com';
            link.textContent = 'Dynamic External Link ' + Date.now();
            link.style.cssText = 'display: inline-block; margin: 5px; padding: 8px 15px; background: #007bff; color: white; text-decoration: none; border-radius: 4px;';
            container.appendChild(link);
            container.appendChild(document.createTextNode(' '));
        });

        document.getElementById('addInternalLink').addEventListener('click', function() {
            const container = document.getElementById('dynamicContainer');
            const link = document.createElement('a');
            link.href = '/page' + Date.now();
            link.textContent = 'Dynamic Internal Link';
            link.className = 'internal-link';
            link.style.cssText = 'display: inline-block; margin: 5px; padding: 8px 15px; background: #28a745; color: white; text-decoration: none; border-radius: 4px;';
            container.appendChild(link);
            container.appendChild(document.createTextNode(' '));
        });

        document.getElementById('addMultipleLinks').addEventListener('click', function() {
            const container = document.getElementById('dynamicContainer');
            const links = [
                { href: 'https://twitter.com', text: 'Twitter' },
                { href: 'https://facebook.com', text: 'Facebook' },
                { href: '/internal', text: 'Internal', internal: true }
            ];

            links.forEach(function(linkData) {
                const link = document.createElement('a');
                link.href = linkData.href;
                link.textContent = linkData.text;
                if (linkData.internal) {
                    link.className = 'internal-link';
                    link.style.cssText = 'display: inline-block; margin: 5px; padding: 8px 15px; background: #28a745; color: white; text-decoration: none; border-radius: 4px;';
                } else {
                    link.style.cssText = 'display: inline-block; margin: 5px; padding: 8px 15px; background: #007bff; color: white; text-decoration: none; border-radius: 4px;';
                }
                container.appendChild(link);
                container.appendChild(document.createTextNode(' '));
            });
        });

        document.getElementById('clearDynamic').addEventListener('click', function() {
            document.getElementById('dynamicContainer').innerHTML = '<em>Dynamic links will appear here...</em>';
        });

        // Manual processing test
        document.getElementById('testManualProcessing').addEventListener('click', function() {
            const container = document.getElementById('manualContainer');

            // Create a link without letting MutationObserver process it
            const div = document.createElement('div');
            div.innerHTML = '<a href="https://manually-processed.com">Manually Processed Link</a>';

            container.innerHTML = '';
            container.appendChild(div);

            // Manually process
            window.lnExternalLinks.process(container);

            log('üîß Manual processing triggered for new link', 'info');
        });

        // Clear log
        document.getElementById('clearLog').addEventListener('click', function() {
            document.getElementById('eventLog').innerHTML = '<em>Events will be logged here...</em>';
            eventCounter = 0;
        });

        // Initial log
        log('üöÄ ln-external-links component loaded and ready', 'info');

        // Log when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                log('üìÑ DOM loaded - initial links processed', 'info');
            });
        } else {
            log('üìÑ DOM already loaded - initial links processed', 'info');
        }
    </script>
</body>
</html>
